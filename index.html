<!DOCTYPE html>
<html lang="fi">
<head>
<meta charset="UTF-8" />
<title>Aulan kalenterit</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<style>
  :root{
    --primary:#007b83;      /* otsikot / korostukset */
    --accent:#ff8114;       /* toissijainen */
    --bg-grad1:#f9f9f9;     /* tausta */
    --bg-grad2:#e9eef3;

    /* Tilannehuone-korttien fonttikoot kokoluokan mukaan */
    --sev-small:1.1rem;
    --sev-medium:1.25rem;
    --sev-large:1.4rem;
  }

  html,body{
    margin:0;
    height:100%;
    background: linear-gradient(135deg,var(--bg-grad1),var(--bg-grad2));
    font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
    color:#222;
    overflow:hidden; /* TV:llä ei vieritystä koko sivulle */
  }

  .app{
    width:100%;
    max-width:1920px;
    height:100vh;
    margin:0 auto;
    display:flex;
    flex-direction:column;
    padding:10px 16px;
    box-sizing:border-box;
  }

  /* Yläpalkki: otsikko + kello */
  .topbar{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:16px;
    margin-bottom:10px;
  }
  .brand{
    display:flex;
    align-items:center;
    gap:12px;
  }
  .brand .dot{
    width:12px; height:12px; border-radius:50%;
    background:var(--primary);
  }
  .brand h1{
    margin:0;
    font-size:1.6rem;
    letter-spacing:0.5px;
    color:#111;
  }
  .clock{
    font-weight:600;
    color:#333;
    font-size:1.1rem;
  }

  /* DIAKARUSELLI */
  .carousel{
    position:relative;
    flex:1;
    border-radius:16px;
    overflow:hidden; /* yksittäisten diojen sisällä hallitaan oma vieritys */
    box-shadow:0 6px 18px rgba(0,0,0,0.15);
    background:#fff;
  }
  .slides{
    display:flex;
    width:300%;
    height:100%;
    transition:transform .55s ease;
    touch-action:pan-y; /* sallii pyyhkäisyn */
  }
  .slide{
    width:100%;
    height:100%;
    overflow:hidden; /* TV:llä ei skrollia oletuksena */
    display:flex;
    flex-direction:column;
    background:#fff;
  }

  .slide-header{
    background:var(--primary);
    color:#fff;
    padding:10px 14px;
    font-weight:700;
    text-align:center;
    font-size:1.3rem;
    letter-spacing:.5px;
  }

  .content{
    flex:1;
    padding:14px;
    background:#e6f2f5;
    overflow:hidden; /* TV */
  }

  /* --- TAPAHTUMALISTA (Miehistö) --- */
  .events-list{
    display:flex;
    flex-direction:column;
    gap:12px;
    height:100%;
    overflow:hidden; /* TV:llä ei scroll; mobiilissa muutetaan */
  }
  .event-card{
    background:#fff;
    border-radius:12px;
    padding:14px;
    box-shadow:0 4px 12px rgba(0,0,0,0.1);
  }
  .event-date{
    display:inline-block;
    padding:6px 10px;
    border-radius:8px;
    color:#fff;
    font-weight:700;
    margin-bottom:8px;
    font-size:1rem;
  }
  .event-title{ font-weight:700; font-size:1.1rem; }
  .event-description{ margin-top:6px; color:#444; font-size:.98rem; }

  /* --- SÄÄ & VAROITUKSET --- */
  .weather-wrap{
    display:grid;
    grid-template-columns:1fr 1fr;
    gap:14px;
    height:100%;
  }
  .panel{
    background:#fff;
    border-radius:12px;
    padding:14px;
    box-shadow:0 4px 12px rgba(0,0,0,0.1);
    display:flex; flex-direction:column;
    overflow:hidden; /* TV */
  }
  .panel h3{
    margin:0 0 8px 0;
    font-size:1.15rem;
    color:#222;
  }
  .now{
    font-size:2.8rem;
    font-weight:800;
    color:#111;
    line-height:1.1;
  }
  .muted{ color:#666; font-size:.95rem; }
  .h-rows{ margin-top:10px; display:flex; gap:8px; flex-wrap:wrap; }
  .chip{
    background:#f3f7fb;
    border:1px solid #dfe7ef;
    border-radius:10px;
    padding:8px 10px;
    min-width:90px;
    text-align:center;
    font-weight:600;
  }
  .warn-list, .forecast-list{
    margin-top:8px;
    display:flex; flex-direction:column;
    gap:8px;
    overflow:hidden; /* TV */
  }
  .warn-item, .forecast-item{
    background:#fefefe;
    border-radius:10px;
    padding:10px;
    border:1px solid #e6eef5;
  }
  .warn-title{
    font-weight:700;
    margin-bottom:4px;
  }

  /* --- TILANNEHUONE --- */
  .th-list{
    display:flex;
    flex-direction:column;
    gap:12px;
    height:100%;
    overflow:hidden; /* TV */
  }
  .th-card{
    background:#fff;
    border-radius:12px;
    padding:14px;
    box-shadow:0 4px 12px rgba(0,0,0,0.1);
  }
  .th-row1{
    display:flex; justify-content:space-between; gap:12px; align-items:center;
    margin-bottom:6px;
  }
  .th-city{ font-weight:800; color:#111; }
  .th-time{ color:#444; font-weight:600; }
  .th-title{
    font-weight:800;
    color:#111;
    line-height:1.2;
    /* font-koko asetetaan JS:ssä kokoluokan mukaan */
  }
  .th-extra{
    margin-top:6px;
    color:#555;
  }

  /* DIA-NAVIGAATIOPISTEET (valinnainen näkymä) */
  .dots{
    position:absolute;
    bottom:10px; left:50%;
    transform:translateX(-50%);
    display:flex; gap:6px;
    background:#ffffffcc;
    padding:6px 10px;
    border-radius:999px;
    box-shadow:0 2px 8px rgba(0,0,0,0.12);
  }
  .dot{
    width:9px; height:9px; border-radius:50%;
    background:#cfd8df;
  }
  .dot.active{ background:var(--primary); }

  /* Mobiilissa: sallitaan sisällön vieritys diassa */
  @media (max-width: 900px){
    html,body{ overflow:auto; }            /* koko sivulla saa vierittää */
    .content{ overflow:auto; }             /* jokaisessa diassa scroll */
    .events-list, .th-list, .warn-list, .forecast-list{ overflow:visible; }
    .weather-wrap{ grid-template-columns:1fr; }
  }
</style>
</head>
<body>
  <div class="app">
    <div class="topbar">
      <div class="brand">
        <span class="dot"></span>
        <h1>Aulan info</h1>
      </div>
      <div class="clock" id="clock">--:--</div>
    </div>

    <div class="carousel" id="carousel">
      <div class="slides" id="slides" aria-live="polite">
        <!-- DIA 1: MIEHISTÖN TAPAHTUMAT -->
        <section class="slide" id="slide-events" aria-label="Miehistön tapahtumat">
          <div class="slide-header">Miehistön tapahtumat</div>
          <div class="content">
            <div class="events-list" id="miehisto-events">
              <div class="event-card" style="text-align:center;color:#555">Ladataan tapahtumia…</div>
            </div>
          </div>
        </section>

        <!-- DIA 2: SÄÄ + VAROITUKSET -->
        <section class="slide" id="slide-weather" aria-label="Sää ja varoitukset">
          <div class="slide-header">Sää & varoitukset</div>
          <div class="content">
            <div class="weather-wrap">
              <!-- Nykyinen sää + lähitunnit -->
              <div class="panel">
                <h3>Klaukkala – nykyinen sää</h3>
                <div id="now-temp" class="now">–°C</div>
                <div id="now-desc" class="muted">—</div>
                <div class="h-rows" id="hourly-chips"></div>

                <h3 style="margin-top:12px">Seuraavat päivät</h3>
                <div class="forecast-list" id="daily-forecast"></div>
              </div>

              <!-- FMI varoitukset -->
              <div class="panel">
                <h3>Ilmatieteen laitos – varoitukset</h3>
                <div class="warn-list" id="warn-list">
                  <div class="warn-item">Ladataan varoituksia…</div>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- DIA 3: TILANNEHUONE -->
        <section class="slide" id="slide-tilanne" aria-label="Tilannehuone">
          <div class="slide-header">Tilannehuone – viimeisimmät hälytykset</div>
          <div class="content">
            <div class="th-list" id="th-list">
              <div class="th-card" style="text-align:center;color:#555">Ladataan hälytyksiä…</div>
            </div>
          </div>
        </section>
      </div>

      <!-- pisteet -->
      <div class="dots" aria-hidden="true">
        <span class="dot" data-i="0"></span>
        <span class="dot" data-i="1"></span>
        <span class="dot" data-i="2"></span>
      </div>
    </div>
  </div>

<script>
/* ================== ASETUKSET ================== */
const API_KEY = 'YOUR_GOOGLE_CALENDAR_API_KEY'; // <-- jätä teillä toimiva avain tähän
const MIEHISTO_CALENDAR_ID = '6fdpm0662hoerp1shdfdjskdbbei1dfe@import.calendar.google.com'; // teillä toimiva

// Cloudflare Worker -proxyn juuri (muuta omaan domainiin tarvittaessa)
const WORKER_BASE = 'https://vpk.mijuze1.workers.dev/?url=';

// Klaukkala koordinaatit (Open-Meteo ennustetta varten)
const KLAUK_LAT = 60.465;
const KLAUK_LON = 24.807;

// Tilannehuone: näytä koko maa mutta nostetaan kärkeen ja valitaan vain nämä kunnat:
const FOCUS_PLACES = [
  'Nurmijärvi','Klaukkala','Rajamäki','Kirkonkylä',
  'Vantaa','Helsinki','Espoo','Kauniainen',
  'Hyvinkää','Järvenpää','Kerava','Tuusula','Mäntsälä',
  'Vihti','Kirkkonummi','Sipoo'
];

// Dia-asetukset
const ROTATE_MS = 20000;

/* ================== YLEISET ================== */
const $ = sel => document.querySelector(sel);
const $$ = sel => Array.from(document.querySelectorAll(sel));

function updateClock(){
  const d = new Date();
  // Europe/Helsinki
  const opts = { hour:'2-digit', minute:'2-digit', second:'2-digit', hour12:false, timeZone:'Europe/Helsinki' };
  $('#clock').textContent = new Intl.DateTimeFormat('fi-FI', opts).format(d);
}
setInterval(updateClock,1000); updateClock();

function stripLinks(html){
  if(!html) return '';
  const div=document.createElement('div'); div.innerHTML=html;
  div.querySelectorAll('a').forEach(a=>a.remove());
  let t=div.textContent||div.innerText||'';
  return t.replace(/https?:\/\/\S+/g,'').trim();
}

/* ================== KARUSELLI ================== */
let idx = 0, touchStartX=null, rotating=null;
const slides = $('#slides');

function setIndex(i){
  const n = 3;
  idx = ((i % n)+n)%n;
  slides.style.transform = `translateX(-${idx*100}%)`;
  $$('.dot').forEach((d,k)=>d.classList.toggle('active', k===idx));
}
function next(){ setIndex(idx+1); }
function prev(){ setIndex(idx-1); }
function startAuto(){ stopAuto(); rotating=setInterval(next, ROTATE_MS); }
function stopAuto(){ if(rotating){ clearInterval(rotating); rotating=null; } }

setIndex(0); startAuto();

slides.addEventListener('touchstart', e=>{ stopAuto(); touchStartX = e.touches[0].clientX; }, {passive:true});
slides.addEventListener('touchmove', e=>{
  if(touchStartX==null) return;
  const dx = e.touches[0].clientX - touchStartX;
  // ei live-dragia – vain suunnan tulkinta
}, {passive:true});
slides.addEventListener('touchend', e=>{
  if(touchStartX==null) return;
  const dx = e.changedTouches[0].clientX - touchStartX;
  if(Math.abs(dx)>40){ dx<0 ? next() : prev(); }
  touchStartX=null; startAuto();
});

/* ================== TAPAHTUMAT (MIEHISTÖ) ================== */

function cleanTitle(title){
  if(!title) return '';
  const m = title.match(/(?:–|:)\s*(.+)$/);
  if(m && m[1]) return m[1].trim();
  return title
    .replace(/^Metsäkylän VPK\s*[-–:]?\s*/i,'')
    .replace(/^Metsäkylän VPK Nuoriso-osasto\s*[-–:]?\s*/i,'')
    .trim();
}

function getDateColor(originalSummary){
  const t = (originalSummary||'').toLowerCase();
  if (t.includes('auto')) return '#fc832f';
  if (t.includes('471') || t.includes('473') || t.includes('477')) return '#fc832f';
  if (t.includes('kalustoesittely') || t.includes('kalusto')) return '#7ab638';
  if (t.includes('päätös')) return '#fcd854';
  if (t.includes('kokous')) return '#fcd854';
  if (t.includes('esittely') || t.includes('alkusammutus') || t.includes('tapahtuma')) return '#7ab638';
  if (t.includes('jokkis') || t.includes('ralli') || t.includes('drift')) return '#7ab638';
  if (t.includes('juhla')) return '#7ab638';
  return '#2178a1';
}

function formatEventDate(startStr, endStr){
  const start = startStr.includes('T') ? new Date(startStr) : new Date(startStr);
  const end   = endStr.includes('T')   ? new Date(endStr)   : new Date(endStr);
  const sameDay = start.toDateString() === end.toDateString();
  const isAllDay = !startStr.includes('T') && !endStr.includes('T');
  if(isAllDay){
    return sameDay ? start.toLocaleDateString('fi-FI')
                   : `${start.toLocaleDateString('fi-FI')} – ${end.toLocaleDateString('fi-FI')}`;
  }else if(sameDay){
    return `${start.toLocaleDateString('fi-FI')} klo ${start.toLocaleTimeString('fi-FI',{hour:'2-digit',minute:'2-digit'})} – ${end.toLocaleTimeString('fi-FI',{hour:'2-digit',minute:'2-digit'})}`;
  }else{
    return `${start.toLocaleDateString('fi-FI')} klo ${start.toLocaleTimeString('fi-FI',{hour:'2-digit',minute:'2-digit'})} – ${end.toLocaleDateString('fi-FI')} klo ${end.toLocaleTimeString('fi-FI',{hour:'2-digit',minute:'2-digit'})}`;
  }
}

function fetchEvents(calendarId){
  const now = new Date().toISOString();
  const url = `https://www.googleapis.com/calendar/v3/calendars/${encodeURIComponent(calendarId)}/events?key=${API_KEY}&timeMin=${now}&orderBy=startTime&singleEvents=true&maxResults=10`;
  return fetch(url).then(r=>r.json());
}

function renderEvent(containerId, events){
  const box = document.getElementById(containerId);
  box.innerHTML = '';
  if(!events || !Array.isArray(events) || !events.length){
    box.innerHTML = '<div class="event-card"><div class="event-title">Ei tapahtumia</div></div>';
    return;
  }
  events.forEach(ev=>{
    const start = (ev.start && (ev.start.dateTime||ev.start.date)) || '';
    const end   = (ev.end   && (ev.end.dateTime  ||ev.end.date))   || '';
    const originalSummary = ev.summary || '';
    const title = cleanTitle(originalSummary);
    const dateBg = getDateColor(originalSummary);
    const desc = ev.description ? stripLinks(ev.description) : '';

    const card = document.createElement('div');
    card.className='event-card';

    const d = document.createElement('div');
    d.className='event-date';
    d.style.background = dateBg;
    d.textContent = formatEventDate(start,end);

    const t = document.createElement('div');
    t.className='event-title';
    t.textContent = title;

    card.appendChild(d);
    card.appendChild(t);
    if(desc){
      const dd=document.createElement('div');
      dd.className='event-description';
      dd.textContent = desc;
      card.appendChild(dd);
    }
    box.appendChild(card);
  });
}

/* ================== SÄÄ + VAROITUKSET ================== */
/* Sää: Open-Meteo (varma & avaimeton), Varoitukset: FMI CAP WFS (proxyn yli) */

async function loadWeather(){
  try{
    // Nykytila + lähitunnit
    const urlNow = `https://api.open-meteo.com/v1/forecast?latitude=${KLAUK_LAT}&longitude=${KLAUK_LON}&current=temperature_2m,relative_humidity_2m,wind_speed_10m&hourly=temperature_2m,precipitation&timezone=Europe%2FHelsinki`;
    const data = await fetch(urlNow).then(r=>r.json());

    // Nykyinen
    const nowT = Math.round(data.current?.temperature_2m ?? NaN);
    const wind = Math.round(data.current?.wind_speed_10m ?? 0);
    $('#now-temp').textContent = isFinite(nowT) ? `${nowT}°C` : '–°C';
    $('#now-desc').textContent = `Tuuli ${wind} m/s`;

    // Lähitunnit (seuraavat 6h)
    const chips = $('#hourly-chips'); chips.innerHTML='';
    const hours = data.hourly?.time || [];
    const temps = data.hourly?.temperature_2m || [];
    const prec  = data.hourly?.precipitation || [];
    const nowIdx = hours.findIndex(ts=> new Date(ts) >= new Date());
    const start = nowIdx>=0 ? nowIdx : 0;
    for(let i=start; i<Math.min(start+6, hours.length); i++){
      const t = new Date(hours[i]);
      const hh = t.toLocaleTimeString('fi-FI',{hour:'2-digit',minute:'2-digit'});
      const chip = document.createElement('div');
      chip.className='chip';
      chip.textContent = `${hh} ${Math.round(temps[i])}°C${prec[i]?` • ${prec[i]}mm`:''}`;
      chips.appendChild(chip);
    }

    // Päiväennuste (Open-Meteo simplified daily)
    const urlDaily = `https://api.open-meteo.com/v1/forecast?latitude=${KLAUK_LAT}&longitude=${KLAUK_LON}&daily=temperature_2m_max,temperature_2m_min,precipitation_sum&timezone=Europe%2FHelsinki`;
    const daily = await fetch(urlDaily).then(r=>r.json());
    const list = $('#daily-forecast'); list.innerHTML='';
    const dTime = daily.daily?.time || [];
    const tmax  = daily.daily?.temperature_2m_max || [];
    const tmin  = daily.daily?.temperature_2m_min || [];
    const psum  = daily.daily?.precipitation_sum || [];
    for(let i=0;i<Math.min(5,dTime.length);i++){
      const row = document.createElement('div');
      row.className='forecast-item';
      const dt = new Date(dTime[i]).toLocaleDateString('fi-FI',{weekday:'short', day:'2-digit', month:'2-digit'});
      row.textContent = `${dt}: ${Math.round(tmin[i])}…${Math.round(tmax[i])}°C${(psum[i]??0)>0?` • ${psum[i]}mm`:''}`;
      list.appendChild(row);
    }
  }catch(e){
    $('#now-desc').textContent = 'Säätietoja ei voitu hakea';
    console.error(e);
  }
}

async function loadWarnings(){
  try{
    // FMI CAP warnings – haetaan koko Suomi + nostetaan tekstissä esiin paikalliset
    const capURL = 'https://opendata.fmi.fi/wfs?service=WFS&request=getFeature&storedquery_id=fmi::warnings::cap::latest';
    const prox = WORKER_BASE + encodeURIComponent(capURL);
    const xmlText = await fetch(prox).then(r=>r.text());
    const xml = new DOMParser().parseFromString(xmlText,'text/xml');

    const warns = Array.from(xml.getElementsByTagName('entry')).map(e=>{
      const title = e.getElementsByTagName('title')[0]?.textContent || '';
      const summary = e.getElementsByTagName('summary')[0]?.textContent || '';
      return {title, summary};
    });

    const list = $('#warn-list'); list.innerHTML='';
    if(!warns.length){
      list.innerHTML = '<div class="warn-item">Ei aktiivisia varoituksia</div>';
      return;
    }
    warns.slice(0,8).forEach(w=>{
      const item=document.createElement('div');
      item.className='warn-item';
      const t=document.createElement('div'); t.className='warn-title'; t.textContent=w.title;
      const s=document.createElement('div'); s.className='muted'; s.textContent= w.summary?.replace(/\s+/g,' ').trim();
      item.appendChild(t); item.appendChild(s);
      list.appendChild(item);
    });
  }catch(e){
    const list = $('#warn-list');
    list.innerHTML = '<div class="warn-item">Varoituksia ei voitu hakea</div>';
    console.error(e);
  }
}

/* ================== TILANNEHUONE ================== */
function toSentenceCase(s){
  if(!s) return '';
  s = s.trim();
  return s.charAt(0).toUpperCase() + s.slice(1);
}
function parseSeverity(text){
  const t = (text||'').toLowerCase();
  if(t.includes('suuri')) return 'large';
  if(t.includes('keskisuuri')) return 'medium';
  return 'small';
}
function setSeverityFont(el, sev){
  if(sev==='large') el.style.fontSize = 'var(--sev-large)';
  else if(sev==='medium') el.style.fontSize = 'var(--sev-medium)';
  else el.style.fontSize = 'var(--sev-small)';
}
function isFocusPlace(name){
  if(!name) return false;
  const n = name.trim().toLowerCase();
  return FOCUS_PLACES.some(p => n === p.toLowerCase());
}

async function loadTilannehuone(){
  try{
    // Tilannehuone listanäkymä – otetaan ”disorder”-lista
    const url = 'https://www.tilannehuone.fi/lista.php?list=disorder';
    const prox = WORKER_BASE + encodeURIComponent(url);
    const html = await fetch(prox).then(r=>r.text());

    // Puhdistetaan skriptit ym.
    const doc = new DOMParser().parseFromString(html,'text/html');

    // Rivien kaivuu: tilannehuone muuttuu välillä, mutta listassa on yleensä table-tyyppinen rakenne
    // Otetaan kaikki tekstisolut ja rakennetaan rivejä heuristisesti esimerkkiesi mukaan:
    // [Kunta] [Päivä Aika] [Tehtävätyyppi (mahd. kokoluokka)]
    const rowsText = doc.body.innerText
      .split('\n')
      .map(s=>s.trim())
      .filter(s=>s);

    // Yritetään löytää rivejä muodossa:
    // Kaupunki \t pvm klo \t tehtävä: koko
    const candidate = [];
    const timeRe = /\d{2}\.\d{2}\.\d{4}\s+\d{1,2}:\d{2}/; // 28.08.2025 16:05
    for(let i=0;i<rowsText.length;i++){
      const s=rowsText[i];
      // jos sisältää päivämäärän -> oletetaan että tätä edeltää paikkakunta ja seuraa tehtäväkuvaus
      if(timeRe.test(s) && i>0 && i<rowsText.length-1){
        const city = rowsText[i-1];
        const task = rowsText[i+1];

        // suodata selkeät roskat
        if(city.length<28 && /[A-Za-zÅÄÖåäö]/.test(city) && task.length<80){
          candidate.push({city, time:s, rawTask:task});
        }
      }
    }

    // Suodata fokuskunnat ja tee kortit
    const list = $('#th-list'); list.innerHTML='';
    const filtered = candidate.filter(r => isFocusPlace(r.city));
    const finalRows = (filtered.length?filtered:candidate).slice(0,12); // näytä 12 uusinta

    if(!finalRows.length){
      list.innerHTML = '<div class="th-card" style="text-align:center;color:#555">Ei tuoreita hälytyksiä</div>';
      return;
    }

    finalRows.forEach(r=>{
      // erottele kokoluokka
      // Esim: "tieliikenneonnettomuus: pieni" tai "ilmaliikenneonnettomuus, suuri"
      const sizeMatch = r.rawTask.match(/(?:[:,]\s*)(pieni|keskisuuri|suuri)/i);
      const size = sizeMatch ? sizeMatch[1].toLowerCase() : 'pieni';
      const sev = parseSeverity(size);

      // siivoa tyyppi (poista kokoluokka-osa)
      let type = r.rawTask.replace(/[:,]\s*(pieni|keskisuuri|suuri)/ig,'').trim();
      type = toSentenceCase(type);

      const card = document.createElement('div');
      card.className='th-card';

      const row1 = document.createElement('div');
      row1.className='th-row1';
      const cty = document.createElement('div'); cty.className='th-city'; cty.textContent=r.city;
      const tm  = document.createElement('div'); tm.className='th-time'; tm.textContent=r.time;
      row1.appendChild(cty); row1.appendChild(tm);

      const title = document.createElement('div');
      title.className='th-title';
      title.textContent = `${type} (${size})`;
      setSeverityFont(title, sev);

      card.appendChild(row1);
      card.appendChild(title);

      list.appendChild(card);
    });

  }catch(e){
    console.error(e);
    const list = $('#th-list');
    list.innerHTML = '<div class="th-card" style="text-align:center;color:#555">Tilannehuoneen tietoja ei voitu hakea</div>';
  }
}

/* ================== INIT ================== */
async function init(){
  // 1) Miehistön tapahtumat
  try{
    const data = await fetchEvents(MIEHISTO_CALENDAR_ID);
    renderEvent('miehisto-events', data.items);
  }catch(e){
    console.error(e);
    $('#miehisto-events').innerHTML = '<div class="event-card"><div class="event-title">Tietojen haku epäonnistui</div></div>';
  }

  // 2) Sää & varoitukset
  await loadWeather();
  await loadWarnings();

  // 3) Tilannehuone
  await loadTilannehuone();

  // Päivityssyklit
  setInterval(async ()=>{
    try{
      const data = await fetchEvents(MIEHISTO_CALENDAR_ID);
      renderEvent('miehisto-events', data.items);
    }catch{}
  }, 15*60*1000); // 15 min

  setInterval(()=>{ loadWeather(); loadWarnings(); }, 15*60*1000); // 15 min
  setInterval(()=>{ loadTilannehuone(); }, 2*60*1000); // 2 min, TH päivittyy melko usein
}
init();
</script>
</body>
</html>
